(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-7f36017d"],{"08ef":function(e,t,s){"use strict";var n=s("fe85"),a=s.n(n);a.a},"0912":function(e,t,s){"use strict";var n=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("table",{staticClass:"neighbor"},[e.statsData?s("tbody",[s("tr",{staticClass:"sequence"},[e._m(0),e.rankList.previous_score?s("td",{staticClass:"previous"},[s("div",{staticClass:"dot ab-center"}),e._m(1)]):e._e(),s("td",{staticClass:"owner"},[s("div",{staticClass:"dot ab-center"}),s("div",{staticClass:"line ab-center flex"},[s("div",{staticClass:"half-line"}),s("div",{staticClass:"half-line",class:{"not-line":!e.rankList.next_score}})])]),e.rankList.next_score?s("td",{staticClass:"next"},[s("div",{staticClass:"dot ab-center"}),e._m(2)]):e._e()]),s("tr",{staticClass:"rank"},[e._m(3),e.rankList.previous_score?s("td",{staticClass:"previous"},[s("span",[e._v("前一名")])]):e._e(),e._m(4),e.rankList.next_score?s("td",{staticClass:"next"},[s("span",[e._v("后一名")])]):e._e()]),s("tr",{staticClass:"score"},[s("td",{staticClass:"first"},[s("span",[e._v(e._s(e.statsData.max_score))])]),e.rankList.previous_score?s("td",{staticClass:"previous"},[s("span",[e._v(e._s(e.rankList.previous_score))])]):e._e(),s("td",{staticClass:"owner"},[s("span",[e._v(e._s(e.rankList.owner_score))])]),e.rankList.next_score?s("td",{staticClass:"next"},[s("span",[e._v(e._s(e.rankList.next_score))])]):e._e()])]):e._e()])},a=[function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("td",{staticClass:"first"},[s("div",{staticClass:"dot ab-center"}),s("div",{staticClass:"line ab-center flex"},[s("div",{staticClass:"half-line not-line"}),s("div",{staticClass:"half-line"})]),s("ul",{staticClass:"dot-ellipsis ab-right"},[s("li"),s("li"),s("li")])])},function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"line ab-center flex"},[s("div",{staticClass:"half-line"}),s("div",{staticClass:"half-line"})])},function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"line ab-center flex"},[s("div",{staticClass:"half-line"}),s("div",{staticClass:"half-line not-line"})])},function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("td",{staticClass:"first"},[s("span",[e._v("第一名")])])},function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("td",{staticClass:"owner"},[s("span",[e._v("我")])])}],i=(s("96cf"),s("3b8d")),r=s("4d61"),c=s("0fea"),o={props:{assessment:{type:Object},currentItem:{type:Object}},data:function(){return{statsData:null}},computed:{isFinal:function(){return!this.currentItem},rankList:function(){return this.statsData.leaderboards},currentStudentId:function(){return c["a"].identity.rid}},watch:{currentItem:function(e,t){e!==t&&(this.statsData=null,this.loadData())}},created:function(){this.loadData()},methods:{loadData:function(){var e=Object(i["a"])(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(!this.isFinal){e.next=6;break}return e.next=3,r["a"].getFinalGradeStats(this.assessment.id,{fields:"leaderboards,max_score",owner_id:this.currentStudentId});case 3:e.t0=e.sent,e.next=9;break;case 6:return e.next=8,r["a"].getItemGradeStats(this.currentItem.id,{fields:"leaderboards,max_score",owner_id:this.currentStudentId});case 8:e.t0=e.sent;case 9:this.statsData=e.t0;case 10:case"end":return e.stop()}},e,this)}));function t(){return e.apply(this,arguments)}return t}()}},u=o,l=(s("587e"),s("2877")),d=Object(l["a"])(u,n,a,!1,null,"f639a97c",null);t["a"]=d.exports},"0e3f":function(e,t,s){"use strict";var n=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"feedback-unfold__mark-score"},[e._l(5,function(t){return[s("div",{ref:"expression",refInFor:!0,staticClass:"expression",class:e.expressionShow(t),style:{cursor:e.allowEdit?"pointer":"default",width:e.size+6+"px",height:e.size+"px"},on:{mouseover:function(s){s.stopPropagation(),e.hoverScore=e.allowEdit?t:0},mouseout:function(t){t.stopPropagation(),e.hoverScore=0},click:function(s){return e.$emit("update:score",e.allowEdit?t:e.score)}}})]})],2)},a=[],i=(s("c5f6"),{props:{allowEdit:{type:Boolean,default:!0},score:Number,size:{type:Number,default:24}},data:function(){return{hoverScore:0}},methods:{expressionShow:function(e){var t=this.hoverScore||this.score,s="";return t||(s="deadpan"),t<=3&&t>0&&(s="sad"),t>3&&(s="smile"),e<=t&&(s+="-checked"),s}}}),r=i,c=(s("16197"),s("2877")),o=Object(c["a"])(r,n,a,!1,null,"67f79174",null);t["a"]=o.exports},16197:function(e,t,s){"use strict";var n=s("dc1c"),a=s.n(n);a.a},"21fa":function(e,t,s){"use strict";var n=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"grade-header card"},[s("div",{staticClass:"card__title"},[e._v(e._s(e.assessmentItem.name))]),s("div",{staticClass:"card-block flex center"},[s("div",{staticClass:"grade-desc__tips"},[s("strong",{staticClass:"block"},[e._v("占总分"+e._s(e.assessmentItem.within_score)+"分")]),s("span",[e._v(e._s("grade"===e.assessment.type?e.$t("尚未发布成绩"):e.$t("还没有教师进行评价")))])])])])},a=[],i=s("48e0"),r={mixins:[i["a"]]},c=r,o=(s("715d"),s("2877")),u=Object(o["a"])(c,n,a,!1,null,"2e6837fe",null);t["a"]=u.exports},"275d":function(e,t,s){"use strict";var n=s("d04d"),a=s.n(n);a.a},"2f06":function(e,t,s){},"33c0":function(e,t,s){"use strict";var n=function(){var e=this,t=e.$createElement,s=e._self._c||t;return e.isStudent||e.alreadySubmit?s("div",{staticClass:"feedback card"},[s("div",{staticClass:"card__title flex justify"},[s("div",{staticClass:"feedback__title"},[s("strong",[e._v("主动反馈")]),e.alreadySubmit?s("label",{staticClass:"label label-primary"},[e._v("已反馈")]):e._e()]),e.alreadySubmit?s("div",{staticClass:"feedback__button",on:{click:function(t){e.shrink=!e.shrink}}},[s("span",[e._v(e._s(e.shrink?"展开详情":"收起详情"))]),s("span",{staticClass:"icon",class:e.shrink?"icon-angle-down":"icon-angle-up"})]):e._e()]),e.alreadySubmit&&e.shrink?e._e():s("div",{staticClass:"card-block"},[!e.alreadySubmit&&e.willInput?[s("span",[e._v("向老师反馈你关于本次成绩的心得或感想吧！")])]:e._e(),e.alreadySubmit||!e.willInput&&!e.showSubmit?[s("div",{staticClass:"feedback-unfold"},[e._m(0),s("div",{staticClass:"feedback-unfold__mark-score"},[s("feedback-face",{attrs:{"allow-edit":!e.alreadySubmit,score:e.thisLevel,size:e.size},on:{"update:score":function(t){e.thisLevel=t}}})],1),s("div",{staticClass:"feedback-unfold__mark-label"},[e._l(e.feedbackLabelValue,function(t,n){return[(e.thisLevel>3?n>0:n<0)?s("label",{staticClass:"label label-default",class:{"label-primary":e.tags&&e.tags.includes(n)},staticStyle:{margin:"0 8px 8px 0"},on:{click:function(t){return e.markLabel(n)}}},[e._v(e._s(t))]):e._e()]})],2),s("div",{staticClass:"feedback-unfold__answer"},[s("textarea",{directives:[{name:"model",rawName:"v-model",value:e.remark,expression:"remark"}],attrs:{disabled:e.alreadySubmit&&"disabled",rows:"4",maxlength:"112",placeholder:e.$t("跟老师吐槽")},domProps:{value:e.remark},on:{input:function(t){t.target.composing||(e.remark=t.target.value)}}})]),e._m(1),s("div",{staticClass:"feedback-unfold__mark-score"},[s("feedback-face",{attrs:{"allow-edit":!e.alreadySubmit,score:e.nextLevel,size:e.size},on:{"update:score":function(t){e.nextLevel=t}}})],1)])]:e._e(),!e.willInput&&e.showSubmit?[s("div",{staticClass:"feedback__submit-ask"},[e._v("提交后将无法修改，确认提交？")])]:e._e()],2),e.alreadySubmit?e._e():s("div",{staticClass:"feedback-vitta flex"},[e.willInput?s("button",{staticClass:"btn btn-important block",on:{click:function(t){e.willInput=!e.willInput}}},[e._v("去反馈!")]):e._e(),e.willInput||e.showSubmit?e._e():s("button",{staticClass:"btn btn-important block",on:{click:e.showConfirm}},[e._v("提交反馈")]),e.showSubmit?[s("button",{staticClass:"btn btn-default flex-1",staticStyle:{"margin-right":"8px"},on:{click:function(t){e.showSubmit=!1}}},[e._v(e._s(e.$t("取消")))]),s("button",{staticClass:"btn btn-important flex-2",on:{click:function(t){return e.submit()}}},[e._v(e._s(e.$t("确认")))])]:e._e()],2)]):e._e()},a=[function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"feedback-unfold__question"},[s("strong",[e._v("我这次发挥的怎么样？")])])},function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"feedback-unfold__question"},[s("strong",[e._v("我对下一次有多大信心？")])])}],i=s("795b"),r=s.n(i),c=(s("ac6a"),s("5df3"),s("96cf"),s("3b8d")),o=(s("6762"),s("2fdb"),s("c5f6"),s("8b2a")),u=s("d225"),l=s("b0b4"),d=s("308d"),m=s("6bb5"),f=s("4e2b"),h=s("3fa7"),p=function(e){function t(){return Object(u["a"])(this,t),Object(d["a"])(this,Object(m["a"])(t).apply(this,arguments))}return Object(f["a"])(t,e),Object(l["a"])(t,null,[{key:"findForStudentAndScore",value:function(){var e=Object(c["a"])(regeneratorRuntime.mark(function e(t){var s,n;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return s="".concat(this.baseURL,"/nas/students/").concat(t.rid,"/scores/").concat(t.scoreId,"/self-assessment-remarks"),e.next=3,this.getJSON(s);case 3:return n=e.sent,e.abrupt("return",new this(n));case 5:case"end":return e.stop()}},e,this)}));function t(t){return e.apply(this,arguments)}return t}()},{key:"createForStudentAndScore",value:function(e,t){var s="".concat(this.baseURL,"/nas/students/").concat(e.rid,"/scores/").concat(e.scoreId,"/self-assessment-remarks");return this.$http.post(s,t)}},{key:"NAME",get:function(){return"ProactiveFeedback"}}]),t}(h["a"]),v=s("0fea"),b=s("0e3f"),g={components:{FeedbackFace:b["a"]},mixins:[o["c"]],props:{size:{type:Number,default:null},assessmentItem:{type:Object,required:!0},scoreDetails:{type:Array,default:function(){return[]}}},data:function(){return{alreadySubmit:!1,shrink:!0,willInput:!0,showSubmit:!1,thisLevel:0,nextLevel:0,tags:[],remark:""}},computed:{selectTags:function(){return this.thisLevel>3?_.filter(this.tags,function(e){return e>0}):_.filter(this.tags,function(e){return e<0})},isStudent:function(){return v["a"].identity.isStudent}},watch:{assessmentItem:function(){this.initFeedbackDetails()}},created:function(){this.initFeedbackDetails()},methods:{markLabel:function(e){this.alreadySubmit||(this.tags.includes(e)?this.tags=_.filter(this.tags,function(t){return+t!==+e}):this.tags.push(e))},showConfirm:function(){try{if(!this.thisLevel)throw new Error(Vue.t("先对本次发挥做个自我评价吧"));if(_.isEmpty(this.selectTags))throw new Error(Vue.t("请至少选择一个原因标签"));this.showSubmit=!0}catch(e){toast.error(e.message)}},submit:function(){var e=Object(c["a"])(regeneratorRuntime.mark(function e(){var t,s,n;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return t={self_assessment_level:this.thisLevel,next_self_assessment_level:this.nextLevel,self_assessment_tags:this.selectTags,self_assessment_remark:this.remark},s=_.map(this.scoreDetails,function(e){return p.createForStudentAndScore({rid:v["a"].identity.rid,scoreId:e.id},t)}),e.next=4,r.a.all(s);case 4:n=e.sent,this.applyData(n[0]);case 6:case"end":return e.stop()}},e,this)}));function t(){return e.apply(this,arguments)}return t}(),initFeedbackDetails:function(){var e=this.scoreDetails[0];this.applyData(e)},applyData:function(e){e.self_assessment_level?(this.alreadySubmit=!0,this.shrink=!0):(this.alreadySubmit=!1,this.shrink=!1),this.willInput=!1,this.showSubmit=!1,this.thisLevel=e.self_assessment_level,this.nextLevel=e.next_self_assessment_level,this.tags=_.isEmpty(e.self_assessment_tags)?[]:e.self_assessment_tags,this.remark=e.self_assessment_remark}}},S=g,C=(s("3e3f"),s("2877")),k=Object(C["a"])(S,n,a,!1,null,"7911ec28",null);t["a"]=k.exports},"3e3f":function(e,t,s){"use strict";var n=s("69f7"),a=s.n(n);a.a},"4dfc":function(e,t,s){},"587e":function(e,t,s){"use strict";var n=s("cdc4"),a=s.n(n);a.a},"69f7":function(e,t,s){},"715d":function(e,t,s){"use strict";var n=s("d12c"),a=s.n(n);a.a},"75be":function(e,t,s){"use strict";var n=s("4dfc"),a=s.n(n);a.a},"8b2a":function(e,t,s){"use strict";s.d(t,"b",function(){return c}),s.d(t,"c",function(){return o});s("7514"),s("96cf");var n=s("3b8d"),a=s("5fdf"),i=s("b04a"),r=s("a76f");t["a"]={methods:{initGradeAssessmentTemplate:function(){return new a["default"]({type:a["TYPE"].grade,is_template:1,dimensions:[],scope_type:a["SCOPE_TYPE"].class,scope_conditions:{}})},initGradeAssessment:function(){return new a["default"]({type:a["TYPE"].grade,is_template:0,dimensions:[],scope_type:a["SCOPE_TYPE"].class,scope_conditions:{}})}}};var c={methods:{getAssessmentById:function(){var e=Object(n["a"])(regeneratorRuntime.mark(function e(t){var s;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,a["default"].find(t,{expand:"dimensions.assessment_items,dimensions.questions,dimensions.questions_usages"});case 2:return s=e.sent,e.abrupt("return",s);case 4:case"end":return e.stop()}},e)}));function t(t){return e.apply(this,arguments)}return t}(),instanceDimensionsItems:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s=t.isCopy,n=void 0!==s&&s,a=_.map(e,function(e){n&&(delete e.id,e.locked=0);var t=new i["e"](e);return t.assessment_items=_.map(e.assessment_items,function(e){return n&&(delete e.id,delete e.status,e.locked=0),new r["d"](e)}),t});return a}}},o={data:function(){return{feedbackLabelValue:{"-5":"需要更努力","-4":"我没有天赋","-3":"题目太难了","-2":"运气不太好","-1":"最近状态不佳",1:"我很努力",2:"我有天赋",3:"题目挺简单",4:"运气很好",5:"最近状态不错"}}}}},"8c82":function(e,t,s){e.exports=s.p+"img/combined-shape.e894f02f.svg"},"8fe8":function(e,t,s){"use strict";var n=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"card"},[s("div",{staticClass:"card__title"},[e._v("成绩分布图")]),e.distributeData?[s("div",{staticClass:"card-block distribute-chart"},[e.gradeData?s("bar-graph",{attrs:{"grade-data":e.gradeData,size:"mobile"}}):e._e()],1),s("div",{staticClass:"card-footer"},[s("ul",{staticClass:"grade-desc flex"},[s("li",{staticClass:"grade-desc__item"},[s("span",{staticClass:"grade-desc__item-title"},[e._v(e._s(e.isGrade?"班级平均分":"平均分"))]),s("span",{staticClass:"grade-desc__item-score"},[e._v(e._s(e._f("round")(e.distributeData.score_average,e.isFinal?1:2)))])]),s("li",{staticClass:"grade-desc__item"},[s("span",{staticClass:"grade-desc__item-title"},[e._v("标准差")]),s("span",{staticClass:"grade-desc__item-score"},[e._v(e._s(e._f("round")(e.distributeData.standard_deviation,2)))])])])])]:e._e()],2)},a=[],i=(s("96cf"),s("3b8d")),r=s("4d61"),c=s("2ae5"),o={components:{BarGraph:c["a"]},props:{assessment:{type:Object},currentItem:{type:Object}},data:function(){return{distributeData:null}},computed:{gradeData:function(){var e=this;if(this.distributeData){var t={};return _.forOwn(this.distributeData.score_ranges,function(s,n){var a=e.currentItem&&"level"===e.currentItem.option_display?"".concat(+n+1,"星"):s.range.join("-");t[a]=s.count}),_.isEmpty(t)?void 0:t}},isGrade:function(){return"grade"===this.assessment.type},isFinal:function(){return!this.currentItem}},watch:{currentItem:function(e,t){e!==t&&(this.distributeData=null,this.loadData())}},created:function(){this.loadData()},methods:{loadData:function(){var e=Object(i["a"])(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(!this.isFinal){e.next=6;break}return e.next=3,r["a"].getFinalGradeStats(this.assessment.id,{fields:"score_ranges,score_average,standard_deviation"});case 3:e.t0=e.sent,e.next=9;break;case 6:return e.next=8,r["a"].getItemGradeStats(this.currentItem.id,{fields:"score_ranges,score_average,standard_deviation"});case 8:e.t0=e.sent;case 9:this.distributeData=e.t0;case 10:case"end":return e.stop()}},e,this)}));function t(){return e.apply(this,arguments)}return t}()}},u=o,l=(s("75be"),s("2877")),d=Object(l["a"])(u,n,a,!1,null,"e067b1ae",null);t["a"]=d.exports},"9dca":function(e,t,s){},a742:function(e,t,s){"use strict";s.r(t);var n=function(){var e=this,t=e.$createElement,s=e._self._c||t;return e.currentAssessmentItem?s("div",[s("assessment-intro",{attrs:{dimension:e.currentDimension,"assessment-item":e.currentAssessmentItem}}),"question"!==e.currentDimension.type?[e.published?s("header-desc-published",{attrs:{assessment:e.assessment,dimension:e.currentDimension,"assessment-item":e.currentAssessmentItem,"item-score":e.currentAssessmentItemScore,"grade-setting":e.gradeSetting}}):s("header-desc-unpublished",{attrs:{assessment:e.assessment,dimension:e.currentDimension,"assessment-item":e.currentAssessmentItem}}),!e.published&&e.currentAssessmentItem.option_self_assessment&&"score_item"!==e.currentAssessmentItem.scoring_type?s("self-score",{attrs:{assessment:e.assessment,"assessment-item":e.currentAssessmentItem,"score-list":e.itemScoreList}}):e._e(),"score_item"===e.currentAssessmentItem.scoring_type?s("mark-score-log",{attrs:{"assessment-item":e.currentAssessmentItem,"score-details":e.currentItemScoreList,"current-dimension":e.currentDimension}}):e._e()]:[s("periodic-feedback",{attrs:{rid:e.reflectionId,"assessment-item":e.currentAssessmentItem,"current-score":e.currentScore}})],e.isShowRemark?s("remark",{attrs:{"current-score":e.currentScore}}):e._e(),e.published?[e.gradeSetting.student_class_average_distribution?s("distribute-chart",{attrs:{"current-item":e.currentAssessmentItem,assessment:e.assessment}}):e._e(),e.currentItemScoreList[0]&&"score_item"!==e.currentAssessmentItem.scoring_type?s("feed-back",{attrs:{"assessment-item":e.currentAssessmentItem,"score-details":e.currentItemScoreList,size:32}}):e._e(),s("change-log",{attrs:{"assessment-item":e.currentAssessmentItem,assessment:e.assessment,"assessment-type":e.ASSESSMENT_TYPE.grade,rid:e.reflectionId}})]:e._e()],2):e._e()},a=[],i=s("5176"),r=s.n(i),c=s("e814"),o=s.n(c),u=(s("96cf"),s("3b8d")),l=(s("6762"),s("2fdb"),s("7514"),s("c5f6"),s("5fdf")),d=s("aa55"),m=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"grade-header card"},[s("div",{staticClass:"card__title"},[e._v(e._s(e.assessmentItem.name))]),s("div",{staticClass:"card-block"},[s("ul",{staticClass:"grade-desc flex"},[s("li",{staticClass:"grade-desc__item"},["yes"===e.dimension.within?[s("div",{staticClass:"grade-desc__item-score"},["level"===e.assessmentItem.option_display?s("se-rate",{staticStyle:{height:"36px","line-height":"32px"},attrs:{value:e.rateScore(e.itemScore),disabled:""}}):s("div",{staticClass:"i-block"},[s("span",[e._v(e._s(e.itemScore.score))]),s("span",{staticClass:"total"},[e._v("/"+e._s(e.itemScore.data.max_score))])])],1),s("div",{staticClass:"grade-desc__item-tips"},[e._v("折算总分"+e._s(e.transformTotal(e.itemScore))+"分")])]:e._e(),"direct"===e.dimension.within?[s("div",{staticClass:"grade-desc__item-score"},[e._v(e._s(e.itemScore.score))]),s("div",{staticClass:"grade-desc__item-tips"},[e._v(e._s(e.$t("从总分中扣除")))])]:e._e()],2),e.shouldShowRank?s("li",{staticClass:"grade-desc__item"},[s("div",{staticClass:"grade-desc__item-score"},[s("span",[e._v(e._s(e.itemScore.assessment_rank))]),s("span",{staticClass:"total"},[e._v("/"+e._s(e.itemScore.assessment_rank_base))])]),s("div",{staticClass:"grade-desc__item-tips"},[e._v("排名/总人数")])]):e._e()]),e.gradeSetting.student_class_average_distribution?s("score-neighbors",{attrs:{"current-item":e.assessmentItem,assessment:e.assessment}}):e._e()],1)])},f=[],h=s("48e0"),p=s("0912"),v={components:{ScoreNeighbors:p["a"]},mixins:[h["a"]],props:{itemScore:{type:Object,required:!0}}},b=v,g=(s("275d"),s("2877")),S=Object(g["a"])(b,m,f,!1,null,"662e75ae",null),C=S.exports,k=s("21fa"),w=s("7929"),y=s("33c0"),x=s("c255"),I=s("9601"),E=s("24ea"),D=s("b899"),L=s("3da8"),A=s("8fe8"),O={components:{HeaderDescPublished:C,HeaderDescUnpublished:k["a"],AssessmentIntro:w["a"],FeedBack:y["a"],ChangeLog:x["a"],MarkScoreLog:I["a"],SelfScore:E["a"],PeriodicFeedback:D["a"],Remark:L["a"],DistributeChart:A["a"]},props:{reflectionId:{type:[String,Number]},assessment:{type:Object,required:!0},dimensionScores:{type:Array},assessmentItemScores:{type:Array},gradeSetting:{type:Object}},data:function(){return{currentDimension:null,currentAssessmentItem:null,itemScoreList:[]}},computed:{currentAssessmentItemScore:function(){return _.find(this.assessmentItemScores,["biz_id",this.currentAssessmentItem.id])},currentItemScoreList:function(){if(this.currentAssessmentItemScore){var e=this.currentAssessmentItemScore.data.score_ids;return _.filter(this.itemScoreList,function(t){return e.includes(t.id)})}},currentScore:function(){var e=this;return _.find(this.itemScoreList,function(t){return t.assessment_item_id===e.currentAssessmentItem.id})},published:function(){if(this.currentAssessmentItem&&!_.isEmpty(this.currentItemScoreList)&&this.currentScore&&!this.currentScore.delayed)return"published"===this.currentAssessmentItem.status},isShowRemark:function(){if(this.currentScore&&("question"===this.currentDimension.type||this.published))return this.currentScore.evaluator_review||!_.isEmpty(this.currentScore.attachments)},ASSESSMENT_TYPE:function(){return l["default"].TYPE}},watch:{$route:{handler:function(){var e=Object(u["a"])(regeneratorRuntime.mark(function e(){var t,s,n;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return t=o()(this.$route.params.id),s=null,n=_.find(this.assessment.dimensions,function(e){if(s=_.find(e.assessment_items,["id",t]),s)return!0}),e.t0=r.a,e.t1=this,e.t2=n,e.t3=s,e.next=9,d["a"].findAllForStudentAndAssessment({assessmentId:this.assessment.id,studentId:this.reflectionId},{expand:"evaluator, score_items.evaluator"});case 9:e.t4=e.sent,e.t5={currentDimension:e.t2,currentAssessmentItem:e.t3,itemScoreList:e.t4},(0,e.t0)(e.t1,e.t5);case 12:case"end":return e.stop()}},e,this)}));function t(){return e.apply(this,arguments)}return t}(),immediate:!0}}},j=O,T=(s("accf"),Object(g["a"])(j,n,a,!1,null,"33f59052",null));t["default"]=T.exports},accf:function(e,t,s){"use strict";var n=s("2f06"),a=s.n(n);a.a},b899:function(e,t,s){"use strict";var n=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"card"},[s("div",{staticClass:"card__title flex justify"},[s("div",{staticClass:"card__title-left"},[s("strong",[e._v("定期问卷")]),e.isSubmitted?s("label",{staticClass:"label label-success",staticStyle:{"margin-left":"8px"}},[e._v("已提交")]):e._e()]),e.isSubmitted?s("div",{staticClass:"card__title-right"},[s("span",{staticClass:"font-color-6"},[e._v("提交时间："+e._s(e.answerTime))])]):e._e()]),s("div",{staticClass:"card-block"},[s("ol",e._l(e.questions,function(t,n){return s("li",{staticClass:"form-group flex"},[s("label",{staticClass:"label-control"},[e._v(e._s(n+1))]),e.answers&&e.answers[t.id]?s("div",{staticClass:"content flex-1"},[s("div",{staticClass:"question"},[e._v(e._s(t.title))]),"score"===t.type?s("div",{staticClass:"answer"},[s("se-rate",{attrs:{value:e.answers[t.id].item_score,readonly:e.isSubmitted,carry:e.answers[t.id]},on:{change:e.markStarScore}})],1):s("div",{staticClass:"answer"},[s("se-textarea",{staticStyle:{width:"100%"},attrs:{rows:2,disabled:e.isSubmitted,"auto-expand":!0},model:{value:e.answers[t.id].item_score_remark,callback:function(s){e.$set(e.answers[t.id],"item_score_remark",s)},expression:"answers[question.id].item_score_remark"}})],1)]):e._e()])}),0)]),s("div",{directives:[{name:"show",rawName:"v-show",value:!e.isSubmitted,expression:"!isSubmitted"}],staticClass:"card-vitta"},[s("button",{staticClass:"btn btn-important",attrs:{type:"button"},on:{click:e.submit}},[e._v("提交评价")])])])},a=[],i=s("0a0d"),r=s.n(i),c=s("cebc"),o=(s("a481"),s("96cf"),s("3b8d")),u=(s("ac6a"),s("c5f6"),s("aa55")),l=s("0fea"),d=s("64d5"),m=s("05a3"),f={components:{SeRate:d["a"]},props:{rid:{type:[Number,String]},currentScore:{type:Object},assessmentItem:{type:Object}},data:function(){return{answers:null,isSubmitted:!1}},computed:{questions:function(){if(this.assessmentItem)return this.assessmentItem.questions},feedback:function(){return _.values(this.answers)},isComplete:function(){return _.every(this.answers,function(e){return 0!==e.item_score||""!==e.item_score_remark})},answerTime:function(){return this.currentScore?moment(this.currentScore.created_at).format("YYYY.M.D"):""},isStudent:function(){return l["a"].identity.isStudent}},watch:{questions:function(){this.initAnswer()},currentScore:{immediate:!0,handler:function(e,t){var s=this;this.initAnswer(),this.isSubmitted=!!e,this.isStudent&&setTimeout(function(){if(s.isSubmitted&&e){var t=[{id:e.id}];u["a"].markStudentRead(t)}},1e3)}}},methods:{markStarScore:function(e,t){t.item_score!==e?t.item_score=e:t.item_score=0},submit:function(){var e=Object(o["a"])(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(this.isComplete){e.next=3;break}return toast.error("必须全部填写才能提交"),e.abrupt("return");case 3:return e.next=5,m["a"].confirm("填写后不能修改，确认提交么？");case 5:if(e.sent){e.next=7;break}return e.abrupt("return");case 7:return e.prev=7,e.next=10,u["a"].inputPeriodicFeedback({studentId:this.rid,assessmentItemId:this.assessmentItem.id},this.feedback);case 10:toast.success("提交成功"),e.next=17;break;case 13:return e.prev=13,e.t0=e["catch"](7),m["a"].alert("提交失败",e.t0.message),e.abrupt("return",!1);case 17:this.refresh();case 18:case"end":return e.stop()}},e,this,[[7,13]])}));function t(){return e.apply(this,arguments)}return t}(),initAnswer:function(){var e=[];e=this.currentScore?this.currentScore.score_items:_.map(this.questions,function(e){return{question_id:e.id,item_score:0,item_score_remark:""}}),this.answers=_.keyBy(e,"question_id")},refresh:function(){this.$router.replace({query:Object(c["a"])({},this.$route.query,{_random_:r()()})})}}},h=f,p=(s("f849"),s("2877")),v=Object(p["a"])(h,n,a,!1,null,"23a7c08c",null);t["a"]=v.exports},c255:function(e,t,s){"use strict";var n=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"change-log"},[e.formattedTimelines.length?n("div",{staticClass:"change-log__card cbox"},[n("div",{staticClass:"change-log__header"},[n("div",{staticClass:"change-log__title"},[e._v(e._s(e.$t("修改历史")))])]),n("div",{staticClass:"change-log__body"},[n("ul",[e._l(e.formattedTimelines,function(t,a){return n("li",{staticClass:"change-log__item"},[n("div",{staticClass:"change-log__circle-wrap"},[n("span",{staticClass:"change-log__circle",class:{"change-log__current-circle":0===a}})]),n("div",{staticClass:"change-log__info"},[n("div",{staticClass:"change-log__scores"},["grade_updated"===t.type||"score"===e.assessmentItem.option_display?[n("span",[e._v(e._s(t.changed.score)+"/"+e._s(e.getFullScore(t)))]),n("img",{staticClass:"change-log__combined-shape",attrs:{src:s("8c82")}}),n("span",{staticClass:"change-log__current-score"},[e._v(e._s(e.getScore(t))+"/"+e._s(e.getFullScore(t)))])]:[n("span",[e._v(e._s(e._f("round")(t.changed.score/t.full_score*5,2))+"/5")]),n("img",{staticClass:"change-log__combined-shape",attrs:{src:s("8c82")}}),n("span",{staticClass:"change-log__current-score"},[e._v(e._s(e._f("round")(t.score/t.full_score*5,2))+"/5")])]],2),t.edit_reason?n("p",{staticClass:"change-log__edit-reason"},[e._v(e._s(t.edit_reason))]):e._e(),n("small",{staticClass:"change-log__time"},[e._v(e._s(e.formatDate(t)))])])])}),e.shouldShowExpand&&!e.expand?n("li",{staticClass:"change-log__item"},[n("span",{staticClass:"change-log__circle"}),n("div",{staticClass:"change-log__info change-log__expand-info",on:{click:function(t){e.expand=!0}}},[n("span",{staticClass:"change-log__expand"},[e._v(e._s(e.$t("展开剩余{count}项",{count:e.timelines.length-e.maxShow})))])])]):e._e()],2)])]):e._e()])},a=[],i=(s("96cf"),s("3b8d")),r=s("75fc"),c=(s("ac6a"),s("7514"),s("c5f6"),s("5fdf")),o={props:{assessment:{type:Object,required:!0},assessmentItem:{type:Object,default:null},assessmentType:{type:String,required:!0},rid:{type:[String,Number],required:!0}},data:function(){return{timelines:null,expand:!1,maxShow:5,query:{assessment_type:this.assessmentType}}},computed:{formattedTimelines:function(){var e=this;if(!this.timelines)return[];var t=this.expand?this.timelines:this.timelines.slice(0,this.maxShow),s=this.assessment.dimensions,n=t.filter(function(e){return e.changed});return n.map(function(t){var n=_.find(e.allItems,function(e){return e.id===t.assessment_item_id}),a=_.find(s,function(e){return e.id===t.dimension_id});return t.assessment_item_option_display=n&&n.option_display,t.dimension_within=a&&a.within,t.dimension_min_score=a&&Math.abs(a.assessment_items[0].min_score),t})},shouldShowExpand:function(){return this.timelines&&this.timelines.length>this.maxShow},allItems:function(){var e=[];return _.forEach(this.assessment.dimensions,function(t){e.push.apply(e,Object(r["a"])(t.assessment_items))}),e}},watch:{assessmentItem:function(){this.expand=!1,this.loadTimelines()},rid:function(e,t){e!==t&&(this.expand=!1,this.loadTimelines())}},created:function(){this.loadTimelines()},methods:{loadTimelines:function(){var e=Object(i["a"])(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return this.assessmentItem?this.query.assessment_item_id=this.assessmentItem.id:(this.query.assessment_id=this.assessment.id,this.query.type=c["TIMELINE_TYPE"].gradeUpdated),e.next=3,c["default"].studentTimelines(this.rid,this.query);case 3:this.timelines=e.sent;case 4:case"end":return e.stop()}},e,this)}));function t(){return e.apply(this,arguments)}return t}(),formatDate:function(e){return moment(e.created_at).format("YYYY-MM-DD")},getScore:function(e){return e.type===c["TIMELINE_TYPE"].gradeUpdated?_.round(e.grade_score,2):_.round(e.score,2)},getFullScore:function(e){return"direct"===e.dimension_within?e.dimension_min_score:e.type===c["TIMELINE_TYPE"].gradeUpdated?_.round(e.grade_full_score,2):_.round(e.full_score,2)}}},u=o,l=(s("08ef"),s("2877")),d=Object(l["a"])(u,n,a,!1,null,"71e7ec1e",null);t["a"]=d.exports},cdc4:function(e,t,s){},d04d:function(e,t,s){},d12c:function(e,t,s){},dc1c:function(e,t,s){},f849:function(e,t,s){"use strict";var n=s("9dca"),a=s.n(n);a.a},fe85:function(e,t,s){}}]);