(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-0726cf8d"],{"0128":function(e,t,s){"use strict";var n=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"sidebar-wrap"},[s("div",{staticClass:"sidebar card"},[s("div",{staticClass:"total-score",class:{checked:e.totalScoreChecked},on:{click:e.checkTotalScore}},[s("div",{staticClass:"total-score__title"},[e._v(e._s("grade"===e.assessment.type?e.$t("总成绩"):e.$t("总得分")))]),s("div",{staticClass:"total-score__info"},[e._v(e._s(e.totalScore)+e._s(e.$t("分")))])]),s("div",{staticClass:"dimensions"},e._l(e.dimensions,function(t){return s("div",{staticClass:"dimensions-item"},[s("div",{staticClass:"dimensions-item__name flex justify",class:{unfold:t.unfold,checked:t.checked,special:e.isSpecialDimension(t)},on:{click:function(s){return e.checkDimension(t)}}},[s("div",{staticClass:"flex-1",staticStyle:{"max-width":"160px"}},[s("div",{staticClass:"dimensions-item__title ellipsis"},[e._v(e._s(t.name))]),s("div",{staticClass:"dimensions-item__info"},["yes"===t.within?[e._v(e._s(e.$t("占{score}分",{score:t.within_score})))]:e._e(),"direct"===t.within?[e._v(e._s(e.$t("最多扣{num}分",{num:Math.abs(t.assessment_items[0].min_score)})))]:e._e(),e._v(", "+e._s(e.calculationType(t)))],2)]),s("div",{staticClass:"unfold icon icon-angle-right",on:{click:function(s){return s.stopPropagation(),e.foldDimension(t)}}})]),e.isSpecialDimension(t)?e._e():s("div",{staticClass:"assessment-items",class:{unfold:t.unfold},style:{"max-height":t.unfold?60*t.assessment_items.length+12+"px":0}},[s("div",{staticClass:"vertical-line"}),e._l(t.assessment_items,function(n){return s("div",{staticClass:"assessment-items__item",class:{checked:n.checked},on:{click:function(t){return e.checkAssessmentsItem(n)}}},[s("div",{staticClass:"assessment-items__item-name ellipsis"},[s("div",{staticClass:"icon icon-angle-right"}),s("span",{staticClass:"title"},[e._v(e._s(n.name))]),"avg"!==t.calculation_type?s("span",{staticClass:"info"},[e._v("（"+e._s(n.max_score)+"）")]):e._e()]),s("div",{staticClass:"assessment-items__item-graph"},["published"===n.status&&null!==n.score?["score"===n.option_display?s("div",{staticClass:"progress-wrap"},[s("div",{staticClass:"progress",style:e.computeScoreProgress(n.score,n.max_score)})]):e._e(),"level"===n.option_display?s("se-rate",{attrs:{value:e.rateScore(n),readonly:""}}):e._e()]:[1!==n.option_self_assessment||n.has_owner_scores?e._e():s("div",{staticClass:"self-score"},[e._v(e._s(e.$t("待自评")))]),1===n.option_self_assessment&&n.has_owner_scores?s("div",{staticClass:"self-score__almounted"},[e._v(e._s(e.$t("已自评")))]):e._e(),1!==n.option_self_assessment?s("div",{staticClass:"unpublished"},[e._v(e._s(e.$t("未发布")))]):e._e()]],2)])})],2)])}),0)]),1===e.currentUser.role?s("div",{staticClass:"sidebar card",staticStyle:{"margin-top":"16px"}},[s("div",{staticClass:"dimensions periodic"},e._l(e.questionDimensions,function(t){return s("div",{staticClass:"dimensions-item"},[s("div",{staticClass:"dimensions-item__name flex justify",class:{unfold:t.unfold},on:{click:function(s){return e.checkDimension(t)}}},[s("div",{staticClass:"flex-1",staticStyle:{"max-width":"100%"}},[s("div",{staticClass:"dimensions-item__title ellipsis"},[e._v(e._s(t.name))])]),s("div",{staticClass:"unfold icon icon-angle-right",on:{click:function(s){return s.stopPropagation(),e.foldDimension(t)}}})]),s("div",{staticClass:"assessment-items",class:{unfold:t.unfold},style:{"max-height":t.unfold?50*t.assessment_items.length+12+"px":0}},[s("div",{staticClass:"vertical-line"}),e._l(t.assessment_items,function(t){return s("div",{staticClass:"assessment-items__item",class:{checked:t.checked},on:{click:function(s){return e.checkAssessmentsItem(t)}}},[s("div",{staticClass:"assessment-items__item-name ellipsis"},[s("div",{staticClass:"icon icon-angle-right"}),s("div",{staticClass:"title flex left"},[s("span",{staticClass:"icon icon-check-circle-b",style:{color:e.questionIconColor(t)}}),s("div",{staticClass:"title_name",staticStyle:{"font-size":"14px"}},[e._v(e._s(t.name))])])])])})],2)])}),0)]):e._e()])},i=[],a=s("59ad"),c=s.n(a),r=s("5d73"),o=s.n(r),l=(s("a481"),s("7514"),s("96cf"),s("3b8d")),u=s("75fc"),d=s("0fea"),h=s("ed08"),m={props:{assessment:{type:Object,required:!0},routeInfo:{type:Object,required:!0},dimensionScores:{type:Array},assessmentItemScores:{type:Array}},data:function(){return{dimensions:[],questionDimensions:[],currentUser:d["a"].identity,totalScoreChecked:!1,currentRoute:null}},computed:{totalScore:function(){return _.sumBy(this.dimensions,"within_score")},allDimensions:function(){return[].concat(Object(u["a"])(this.dimensions),Object(u["a"])(this.questionDimensions))}},watch:{$route:{immediate:!0,handler:function(){var e=Object(l["a"])(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:this.currentRoute=_.find(this.routeInfo,["current",!0]),this.initList();case 2:case"end":return e.stop()}},e,this)}));function t(){return e.apply(this,arguments)}return t}()}},methods:{checkAssessmentsItem:function(e){e.checked||(this.clearChecked(),this.$emit("change","item"),e.checked=!0,this.$router.replace({name:this.routeInfo.item.name,params:{id:e.id}}),Object(h["d"])())},checkDimension:function(e){this.isSpecialDimension(e)&&e.unfold||(this.isQuestionDimension(e)?e.unfold=!e.unfold:(this.clearChecked(),this.$emit("change","dimension"),this.isSpecialDimension(e)?(e.unfold=!0,e.assessment_items[0].checked=!0,this.$router.replace({name:this.routeInfo.item.name,params:{id:e.assessment_items[0].id}})):(e.unfold=!0,e.checked=!0,this.$router.replace({name:this.routeInfo.dimension.name,params:{id:e.id}})),Object(h["d"])()))},foldDimension:function(e){e.unfold=!e.unfold},checkTotalScore:function(){this.totalScoreChecked||(this.clearChecked(),this.$emit("change","total"),this.totalScoreChecked=!0,this.$router.replace({name:this.routeInfo.final.name}))},clearChecked:function(){this.totalScoreChecked=!1;var e=!0,t=!1,s=void 0;try{for(var n,i=o()(this.allDimensions);!(e=(n=i.next()).done);e=!0){var a=n.value;this.isSpecialDimension(a)?a.unfold=!1:a.checked=!1;var c=!0,r=!1,l=void 0;try{for(var u,d=o()(a.assessment_items);!(c=(u=d.next()).done);c=!0){var h=u.value;h.checked=!1}}catch(m){r=!0,l=m}finally{try{c||null==d.return||d.return()}finally{if(r)throw l}}}}catch(m){t=!0,s=m}finally{try{e||null==i.return||i.return()}finally{if(t)throw s}}},initList:function(){var e=this,t=_.cloneDeep(this.assessment.dimensions),s=!0,n=!1,i=void 0;try{for(var a,c=o()(t);!(s=(a=c.next()).done);s=!0){var r=a.value;r.unfold=!1;var l=_.find(this.dimensionScores,["biz_id",r.id]);r.score=l&&l.score,this.isSpecialDimension(r)&&(r.unfold=!1),r.checked=!1;var u=!0,d=!1,h=void 0;try{for(var m,f=o()(r.assessment_items);!(u=(m=f.next()).done);u=!0){var v=m.value;v.checked=!1;var p=_.find(this.assessmentItemScores,["biz_id",v.id]);v.score=p&&p.score}}catch(y){d=!0,h=y}finally{try{u||null==f.return||f.return()}finally{if(d)throw h}}}}catch(y){n=!0,i=y}finally{try{s||null==c.return||c.return()}finally{if(n)throw i}}this.currentRoute.name===this.routeInfo.final.name&&(this.totalScoreChecked=!0),this.currentRoute.name===this.routeInfo.dimension.name?_.find(t,["id",this.currentRoute.id]).checked=!0:this.currentRoute.name===this.routeInfo.item.name&&(_.find(t,function(t){var s=_.find(t.assessment_items,["id",e.currentRoute.id]);if(s)return s.checked=!0,!0}).unfold=!0),this.dimensions=_.filter(t,function(e){return"question"!==e.type}),this.questionDimensions=_.filter(t,{type:"question"})},isSpecialDimension:function(e){if("question"!==e.type)return"attendance"===e.type||"score_item"===e.scoring_type},isQuestionDimension:function(e){return"question"===e.type},calculationType:function(e){if("no"===e.within)return"不计入总分";if(2===e.scoring_type||this.isSpecialDimension(e))return"多次加减";switch(e.calculation_type){case"sum":return"多项求和";case"avg":return"多项平均"}},rateScore:function(e){return Math.round(e.score/e.max_score*5)},computeScoreProgress:function(e,t){var s=c()(e/t*100),n=function(){return s>80?"#7ed321":s>20&&s<=80?"#f5b03f":s<=20?"#ef5e5e":void 0}();return{background:n,width:"".concat(s,"%")}},questionIconColor:function(e){return e.checked?"#357BE8":e.has_owner_scores?"#4AA423":"#999"}}},f=m,v=(s("5af3"),s("2877")),p=Object(v["a"])(f,n,i,!1,null,"4eb69784",null);t["a"]=p.exports},"5af3":function(e,t,s){"use strict";var n=s("95e2"),i=s.n(n);i.a},"95e2":function(e,t,s){},aa55:function(e,t,s){"use strict";s.d(t,"a",function(){return h});var n=s("cebc"),i=(s("96cf"),s("3b8d")),a=s("d225"),c=s("308d"),r=s("6bb5"),o=s("b0b4"),l=s("4e2b"),u=s("3fa7"),d=s("888c"),h=function(e){function t(){var e,s;Object(a["a"])(this,t);for(var n=arguments.length,i=new Array(n),o=0;o<n;o++)i[o]=arguments[o];return s=Object(c["a"])(this,(e=Object(r["a"])(t)).call.apply(e,[this].concat(i))),s.oldScore=void 0===s.oldScore?s.score:s.oldScore,s}return Object(l["a"])(t,e),Object(o["a"])(t,null,[{key:"NAME",get:function(){return"Score"}},{key:"controller",get:function(){return"nas/scores"}}]),Object(o["a"])(t,[{key:"isChanged",get:function(){return this.score!==this.oldScore||this.delayed!==this.oldDelayed||this.delayed_reason!==this.oldDelayedReason||this.evaluator_review!==this.oldEvaluatorReview||!_.isEqual(this.attachments,this.oldAttachments)}},{key:"isChangedExceptScore",get:function(){return this.delayed!==this.oldDelayed||this.delayed_reason!==this.oldDelayedReason||this.evaluator_review!==this.oldEvaluatorReview||!_.isEqual(this.attachments,this.oldAttachments)}},{key:"isScoreDirty",get:function(){var e=function(e){return""===e||null==e};return(!e(this.oldScore)||!e(this.score))&&(!(!e(this.oldScore)||e(this.score))||(!(e(this.oldScore)||!e(this.score))||Math.abs(+this.score-+this.oldScore)>=.01))}}],[{key:"batchCreate",value:function(e){if(!_.isArray(e)||!e.length)return null;var t="".concat(this.baseURL,"/").concat(this.controller,"/$batch");return this.$http.post(t,e)}},{key:"batchUpdate",value:function(e){if(!_.isArray(e)||!e.length)return null;var t="".concat(this.baseURL,"/").concat(this.controller,"/$batch");return this.$http.put(t,e)}},{key:"batchSave",value:function(){var e=Object(i["a"])(regeneratorRuntime.mark(function e(t){var s;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return s="".concat(this.baseURL,"/").concat(this.controller,"/v2/$batch"),e.abrupt("return",this.$http.put(s,t));case 2:case"end":return e.stop()}},e,this)}));function t(t){return e.apply(this,arguments)}return t}()},{key:"findAllAssessmentItemScore",value:function(e){var t="".concat(this.baseURL,"/nas/assessment-item-scores");return this.findAll(e,{url:t})}},{key:"findAllDimensionScore",value:function(e){var t="".concat(this.baseURL,"/nas/dimension-scores");return this.findAll(e,{url:t})}},{key:"findAllForStudentAndAssessment",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s="".concat(this.baseURL,"/nas/students/").concat(e.studentId,"/assessments/").concat(e.assessmentId,"/scores"),i=Object(n["a"])({"per-page":99999},t);return this.findAll(i,{url:s})}},{key:"findAllAssessmentItemsForStudent",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s="".concat(this.baseURL,"/nas/students/").concat(e.studentId,"/assessments/").concat(e.assessmentId,"/assessment-item-scores"),i=Object(n["a"])({"per-page":99999},t);return this.findAll(i,{url:s})}},{key:"findAllDimensionForStudent",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s="".concat(this.baseURL,"/nas/students/").concat(e.studentId,"/assessments/").concat(e.assessmentId,"/dimension-scores"),i=Object(n["a"])({"per-page":99999},t);return this.findAll(i,{url:s})}},{key:"findAllForMoralAssessment",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s="".concat(this.baseURL,"/nas/moral-assessments/").concat(e,"/scores");return this.findAll(d["a"].formatQuery(t,"reflection."),{url:s})}},{key:"createByStudent",value:function(e,t){var s=e.studentId,n=e.assessmentItemId,i="".concat(this.baseURL,"/nas/students/").concat(s,"/assessment-items/").concat(n,"/self-assessment-scores");return this.$http.post(i,t)}},{key:"batchUpdateItems",value:function(e){if(!_.isArray(e)||!e.length)return null;var t="".concat(this.baseURL,"/nas/score-items/$batch");return this.$http.post(t,e)}},{key:"batchDeleteItems",value:function(e){if(!e)return null;var t="".concat(this.baseURL,"/nas/score-items/$batch"),s={id:e};return this.$http.delete(t,{data:s})}},{key:"markTeacherRead",value:function(e){if(!_.isArray(e)||!e.length)return null;var t="".concat(this.baseURL,"/").concat(this.controller,"/teacher-views/$batch");return this.$http.put(t,e)}},{key:"markStudentRead",value:function(e){if(!_.isArray(e)||!e.length)return null;var t="".concat(this.baseURL,"/").concat(this.controller,"/student-views/$batch");return this.$http.put(t,e)}},{key:"inputPeriodicFeedback",value:function(e,t){var s=e.studentId,n=e.assessmentItemId,i="".concat(this.baseURL,"/nas/students/").concat(s,"/assessment-items/").concat(n,"/question-score-items/$batch");return this.$http.post(i,t)}},{key:"getAbnormalStats",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.$http.post("".concat(this.baseURL,"/").concat(this.controller,"/abnormal-stats/$query"),e)}},{key:"findScoresForStudent",value:function(e,t){return this.findAll(t,{url:"".concat(this.baseURL,"/nas/students/").concat(e,"/scores")})}}]),t}(u["a"])}}]);