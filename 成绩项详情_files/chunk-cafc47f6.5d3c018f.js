(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-cafc47f6"],{"374d":function(t,e,n){},"3d5e":function(t,e,n){t.exports=n.p+"img/no-attendance-today.2de7a903.png"},"610d3":function(t,e,n){"use strict";var s=n("c201"),r=n.n(s);r.a},7150:function(t,e,n){"use strict";var s=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",["rectangle"===t.size?s("div",{staticClass:"true-avatar"},[t.innerUrl&&t.innerUrl.length>3?s("img",{staticClass:"pointer",attrs:{src:t._f("filterAvatarUrl")(t.innerUrl,"120-160")}}):s("img",{attrs:{src:n("aa3b")}})]):s("div",{staticClass:"avatar",style:{width:t.width+"px",height:t.width+"px"},on:{click:function(e){return t.$emit("click")}}},[t.innerUrl&&t.innerUrl.length>3?s("img",{class:{pointer:t.pointer},style:{width:t.width+"px",height:t.width+"px",verticalAlign:"initial"},attrs:{src:t._f("filterAvatarUrl")(t.innerUrl)}}):s("div",{staticClass:"default-avatar",style:{lineHeight:t.width+"px",fontSize:t.fontSize+"px",backgroundColor:t.color}},[t._v(t._s(t.processName()))]),t._t("icon")],2)])},r=[],a=(n("7514"),n("96cf"),n("3b8d")),i=n("e814"),c=n.n(i),u=(n("c5f6"),n("8d81")),o=n.n(u),l=n("8654"),h=n("0fea"),d=n("f4e3"),f=n.n(d),v={props:{pointer:{type:Boolean,default:!1},size:{type:[String,Number],default:"medium"},reflection:{type:Object,default:function(){return{}}},name:{type:String,default:""},url:{type:String,default:""}},data:function(){return{width:40,fontSize:0,innerUrl:""}},computed:{r:function(){return this.width/2},color:function(){var t=c()(o()(this.innerName).slice(10,14),16)%360;return"hsla(".concat(t,", 50%, 50%, 1)")},innerName:function(){return this.name||this.reflection.name}},watch:{url:function(){this.innerUrl=this.url,this.render()},reflection:function(){this.render()}},mounted:function(){var t=this;this.$nextTick(function(){t.innerUrl=t.url,t.render()})},methods:{setUrl:function(){var t=Object(a["a"])(regeneratorRuntime.mark(function t(){var e;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:if(!this.url&&!this.name){t.next=2;break}return t.abrupt("return");case 2:if(this.reflection){t.next=5;break}return this.innerUrl=f.a,t.abrupt("return");case 5:if(!h["a"].identity.isStudent||1!==this.reflection.role){t.next=12;break}return t.next=8,l["a"].find(this.reflection.uid);case 8:e=t.sent,this.innerUrl=e.avatar,t.next=13;break;case 12:this.innerUrl=this.reflection.avatar;case 13:case"end":return t.stop()}},t,this)}));function e(){return t.apply(this,arguments)}return e}(),reset:function(){switch(this.size){case"small":this.fontSize=7,this.width=24;break;case"medium":this.fontSize=12,this.width=40;break;case"large":this.fontSize=20,this.width=64;break;default:this.width=+this.size,this.fontSize=this.width/3-1;break}},processName:function(){var t=/^[A-Za-z]+$/;return t.test(this.innerName[0])?this.innerName[0].toLocaleUpperCase():this.innerName.slice(-2)},render:function(){var t=Object(a["a"])(regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return this.reset(),t.next=3,this.setUrl();case 3:case"end":return t.stop()}},t,this)}));function e(){return t.apply(this,arguments)}return e}()}},p=v,m=(n("610d3"),n("2877")),b=Object(m["a"])(p,s,r,!1,null,"16bf2e72",null);e["a"]=b.exports},"7e40":function(t,e,n){"use strict";var s=function(){var t=this,e=t.$createElement,s=t._self._c||e;return t.hasAttendance?s("div",[t.columnDetails[0]&&t.columnDetails[0].results.length>0?[s("div",{staticClass:"flex justify font-16",staticStyle:{"margin-bottom":"16px"}},[s("div",[t._v(t._s(t.$t("共{number}名学生",{number:t.studentCount})))]),s("div",{staticClass:"flex right"},[null!==t.classMergedStatus&&1!==t.currentLessonsArray.length?[s("div",{directives:[{name:"tooltip",rawName:"v-tooltip",value:t.$t("连堂考勤是连堂的每节课的考勤(如1，2节连堂课，在连堂模式下考勤状态为迟到，则学生第1节，第2节都迟到)。若有学生的考勤状态不同，请切换分堂考勤模式。"),expression:"$t('连堂考勤是连堂的每节课的考勤(如1，2节连堂课，在连堂模式下考勤状态为迟到，则学生第1节，第2节都迟到)。若有学生的考勤状态不同，请切换分堂考勤模式。')"}],staticClass:"i-block tooltip-pre",staticStyle:{"margin-right":"12px",color:"#666",cursor:"pointer"}},[s("i",{staticClass:"icon icon-question-circle-b font-18",staticStyle:{"vertical-align":"-2px"}})]),s("div",{staticClass:"toogle btn-group"},[s("div",{staticClass:"btn btn-tiny",class:{active:t.classMerged},on:{click:function(e){return t.changeClassMerged(!0)}}},[t._v(t._s(t.$t("连堂考勤")))]),s("div",{staticClass:"btn btn-tiny",class:{active:!t.classMerged},on:{click:function(e){return t.changeClassMerged(!1)}}},[t._v(t._s(t.$t("分堂考勤")))])])]:t._e(),t.isAllowModify||t.isNewSheet?s("div",{staticStyle:{"margin-left":"8px"}},[s("batch-edit",{on:{"batch-edit":t.batchEdit}})],1):t._e()],2)]),t.sort?s("table",{staticClass:"table"},[s("thead",[s("tr",[s("th",{staticStyle:{width:"4%"}}),s("th",{staticStyle:{width:"30%"}},[s("div",{staticClass:"th-title"},[t._v(t._s(t.$t("姓名／学号")))]),s("se-dropdown",{staticClass:"flex left i-block",attrs:{menu:[{label:t.$t("按学号排序"),event:"clickLable1"},{label:t.$t("按姓名拼音排序"),event:"clickLable2"}]},on:{clickLable1:function(e){return t.setSort("usin")},clickLable2:function(e){return t.setSort("pinyin")}}},[s("span",[t._v(t._s("usin"===t.sort?t.$t("按学号排序"):t.$t("按姓名拼音排序")))]),s("i",{staticClass:"icon icon-angle-down",staticStyle:{"margin-left":"3px"}})])],1),s("th",{staticStyle:{width:"66%"}},[s("div",{staticStyle:{"margin-left":"50px"}},[s("div",{staticClass:"th-title"},[t._v(t._s(t.$t("考勤状态")))]),s("div",[t.isNewSheet?[t._v(t._s(t.$t("未考勤")))]:[t.recordedStudentCount>0&&t.recordedStudentCount<t.studentCount?[t._v(t._s(t.$t("{number}/{total}人已考勤",{number:t.recordedStudentCount,total:t.studentCount}))),s("div",{directives:[{name:"tooltip",rawName:"v-tooltip",value:t.$t("正常状态为绿色表示已记录考勤，比如学生已刷卡考勤。蓝色表示还未考勤，默认正常。"),expression:"$t('正常状态为绿色表示已记录考勤，比如学生已刷卡考勤。蓝色表示还未考勤，默认正常。')"}],staticClass:"i-block tooltip-pre",staticStyle:{"margin-left":"6px",color:"#666",cursor:"pointer"}},[s("i",{staticClass:"icon icon-question-circle-b font-16"})])]:[t._v(t._s(t.$t("已考勤")))]]],2)])])])]),s("tbody",t._l(t.displayAttendanceSheets,function(e,n){return s("tr",{key:e.user.id},[s("td",{staticStyle:{position:"relative"}},[t.firstLetters[n]?s("span",{staticClass:"first-letter ab-left-top flex center"},[t._v(t._s(t.firstLetters[n]))]):t._e()]),s("td",{staticClass:"relative"},[s("avatar",{staticClass:"avatar i-block v-mid",attrs:{reflection:e.user,size:36,"font-size":13}},[0!=e.isLeave.leave_count?s("div",{directives:[{name:"tooltip",rawName:"v-tooltip",value:e.isLeave.tooltip_value,expression:"singlePersonSheet.isLeave.tooltip_value"}],class:{"leave-untreated":1===e.isLeave.most_status,"leave-success":2===e.isLeave.most_status||5===e.isLeave.most_status,"leave-reject":3===e.isLeave.most_status,"leave-wait-report":4===e.isLeave.most_status},attrs:{slot:"icon"},on:{click:function(n){return t.viewLeave(e)}},slot:"icon"},[1===e.isLeave.most_status?s("span",[t._v(t._s(t.$t("待")))]):t._e(),2===e.isLeave.most_status||5===e.isLeave.most_status?s("span",[t._v(t._s(t.$t("请")))]):t._e(),3===e.isLeave.most_status?s("span",[t._v(t._s(t.$t("驳")))]):t._e(),4===e.isLeave.most_status?s("span",[t._v(t._s(t.$t("销")))]):t._e()]):t._e()]),s("div",{staticClass:"i-block v-mid"},[s("span",[t._v(t._s(t._f("localizeName")(e.user)))]),s("br"),s("span",[t._v(t._s(e.user.usin))])])],1),s("td",[t.classMerged?[s("div",{staticClass:"classMerged"},[!t.isAllowModify&&!t.isNewSheet||t.isBanRepair?[s("se-button",{staticClass:"btn btn-default active",class:{"btn-red":"normal"!==e.attendance[0].checking_status,recorded:t.isRecordedNormal(e.attendance[0])}},[t._v(t._s(t._f("filterAttendanceCheckingStatus")(e.attendance[0].checking_status)))])]:[s("se-button",{staticClass:"btn btn-default",class:{active:"normal"===e.attendance[0].checking_status,recorded:t.isRecordedNormal(e.attendance[0])},staticStyle:{"margin-right":"16px"},on:{click:function(n){return t.changeAttendanceStatus(e.attendance,"normal")}}},[t._v(t._s(t.$t("正常")))]),s("div",{staticClass:"btn-group"},t._l(["absent","lated","early_left"],function(n,r){return s("se-button",{key:r,staticClass:"btn btn-default btn-red",class:{active:e.attendance[0].checking_status===n},on:{click:function(s){return t.changeAttendanceStatus(e.attendance,n)}}},[t._v(t._s(t._f("filterAttendanceCheckingStatus")(n)))])}),1)]],2)]:t._l(e.attendance,function(e,n){return s("div",{staticClass:"classSplit"},[!t.isAllowModify&&!t.isNewSheet||t.isBanRepair?[s("div",{staticClass:"classIndex"},[t._v(t._s(t.transformLesson(+t.currentLessonStart+n)))]),s("se-button",{staticClass:"btn btn-default active",class:{"btn-red":"normal"!==e.checking_status,recorded:t.isRecordedNormal(e)}},[t._v(t._s(t._f("filterAttendanceCheckingStatus")(e.checking_status)))])]:[s("div",{staticClass:"classIndex"},[t._v(t._s(t.transformLesson(+t.currentLessonStart+n)))]),s("se-button",{staticClass:"btn btn-default",class:{active:"normal"===e.checking_status,recorded:t.isRecordedNormal(e)},staticStyle:{"margin-right":"16px"},on:{click:function(n){return t.changeAttendanceStatus(e,"normal")}}},[t._v(t._s(t.$t("正常")))]),s("div",{staticClass:"btn-group"},t._l(["absent","lated","early_left"],function(n,r){return s("se-button",{key:r,staticClass:"btn btn-default btn-red",class:{active:e.checking_status===n},on:{click:function(s){return t.changeAttendanceStatus(e,n)}}},[t._v(t._s(t._f("filterAttendanceCheckingStatus")(n)))])}),1)]],2)})],2)])}),0)]):t._e(),t.showSaveButton&&(t.isAllowModify||t.isNewSheet)&&!t.isBanRepair?s("div",{staticClass:"flex right",staticStyle:{margin:"15px 22px 20px 0"}},[s("div",{staticClass:"btn btn-important",on:{click:function(e){return t.saveSheets()}}},[t._v(t._s(t.isNewSheet?t.$t("提交考勤"):t.$t("修改考勤")))])]):t._e()]:t._e(),t.columnDetails[0]&&t.columnDetails[0].results.length<=0?s("div",{staticClass:"flex center font-18 font-color-6",staticStyle:{height:"300px"}},[s("p",[t._v(t._s(t.$t("这个班没有学生，无法进行考勤")))])]):t._e()],2):s("div",[s("img",{attrs:{src:n("3d5e")}})])},r=[],a=n("cebc"),i=(n("6762"),n("2fdb"),n("5df3"),n("795b")),c=n.n(i),u=(n("28a5"),n("db0c")),o=n.n(u),l=n("768b"),h=(n("96cf"),n("3b8d")),d=(n("20d6"),n("ac6a"),n("55dd"),n("5d73")),f=n.n(d),v=(n("c5f6"),n("170a")),p=n("99b6"),m=n("d9ef"),b=n("ed08"),g=n("5bf1"),S=n("4efd"),y=n("0fea"),w=n("9942"),k=n("7150"),x=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("se-popper",{attrs:{options:{placement:"bottom-end"}}},[n("se-button",{attrs:{slot:"reference"},slot:"reference"},[t._v(t._s(t.$t("批量标记")))]),n("div",{staticClass:"batch-edit"},[n("div",{staticClass:"batch-edit__radios"},[n("se-radio",{attrs:{option:"all"},model:{value:t.type,callback:function(e){t.type=e},expression:"type"}},[t._v(t._s(t.$t("全部标记为")))]),n("se-radio",{staticStyle:{"margin-left":"8px"},attrs:{option:"usin"},model:{value:t.type,callback:function(e){t.type=e},expression:"type"}},[t._v(t._s(t.$t("标记指定学号为")))])],1),n("div",{staticClass:"batch-edit__usins"},["usin"===t.type?n("se-textarea",{attrs:{placeholder:"多个学号请用逗号隔开，或者每行一个",rows:"4"},model:{value:t.usins,callback:function(e){t.usins=e},expression:"usins"}}):t._e()],1),n("div",{staticClass:"batch-edit__buttons"},[n("se-button",{staticStyle:{"margin-right":"8px"},on:{click:function(e){return t.emitEvent("normal")}}},[t._v(t._s(t.$t("正常")))]),n("se-button-group",[n("se-button",{attrs:{type:"danger"},on:{click:function(e){return t.emitEvent("absent")}}},[t._v(t._s(t.$t("缺席")))]),n("se-button",{attrs:{type:"danger"},on:{click:function(e){return t.emitEvent("lated")}}},[t._v(t._s(t.$t("迟到")))]),n("se-button",{attrs:{type:"danger"},on:{click:function(e){return t.emitEvent("early_left")}}},[t._v(t._s(t.$t("早退")))])],1)],1)])],1)},C=[],A=n("0481"),L=n("ac6b"),D={components:{SePopper:A["a"]},data:function(){return{type:"all",usins:""}},methods:{emitEvent:function(t){if("all"!==this.type){var e=this.usins.split(/[,，\n]/).map(function(t){return t?t.trim():t}).filter(function(t){return t});e.length?this.$emit("batch-edit",t,e):L["a"].error("请输入至少一个学号")}else this.$emit("batch-edit",t)}},i18n:{messages:{"en-US":{"批量标记":"Batch mark as","全部标记为":"Mark all as","标记指定学号为":"Mark student with certain number as"}}}},$=D,N=(n("b577"),n("2877")),E=Object(N["a"])($,x,C,!1,null,"6e24f21a",null),R=E.exports,j="YYYY-MM-DD",O={components:{SeDropdown:w["a"],Avatar:k["a"],BatchEdit:R},mixins:[g["a"]],props:{currentClass:{type:Object,required:!0},currentLesson:{type:[Number,String],default:""},currentDate:{type:String,default:moment().format(j)},classAdjustmentHelper:{type:Object,required:!0},showSaveButton:{type:Boolean,default:!1},hasAttendance:{type:Boolean,default:!1},eventHub:{type:Object,default:function(){return new Vue}}},data:function(){return{dateOptions:[],columns:{},currentSemester:v["default"].current,columnDetails:[],displayAttendanceSheets:null,lessonDistribute:{},sort:null,classMerged:!0,allowUpdateInDays:3,disallowLateSubmissions:!1}},computed:{sortedAttendanceSheets:function(){var t=this,e=[],n=!0,s=!1,r=void 0;try{for(var a,i=f()(this.columnDetails);!(n=(a=i.next()).done);n=!0){var c=a.value;e.push(_.sortBy(c.results,function(e){return e.user[t.sort]}))}}catch(u){s=!0,r=u}finally{try{n||null==i.return||i.return()}finally{if(s)throw r}}return e},firstLetters:function(){if("usin"===this.sort)return[];var t={},e="";return this.sortedAttendanceSheets[0].forEach(function(n,s){var r=n.user,a=_.first(r.pinyin);a!==e&&(t[s]=a,e=a)}),t},currentLessonIndex:function(){var t=this;return _.findIndex(this.columns[this.currentDate].lessons,function(e){return e===t.currentLesson})},currentLessonEnd:function(){var t,e=this.columns[this.currentDate].lessons;for(t=this.currentLessonIndex;t<e.length-1;t+=1)if(e[t]!==e[t+1]-1)break;return e[t]},currentLessonStart:function(){var t,e=this.columns[this.currentDate].lessons;for(t=this.currentLessonIndex;t>0;t-=1)if(e[t]!==e[t-1]+1)break;return e[t]},currentLessonsArray:function(){for(var t=[],e=+this.currentLessonStart;e<=this.currentLessonEnd;e+=1)t.push(e);return t},isNewSheet:function(){if(!this.columnDetails)return!1;var t=!0,e=!1,n=void 0;try{for(var s,r=f()(this.columnDetails);!(t=(s=r.next()).done);t=!0){var a=s.value;if(!a.is_new)return!1}}catch(i){e=!0,n=i}finally{try{t||null==r.return||r.return()}finally{if(e)throw n}}return!0},classMergedStatus:function(){if(!this.sortedAttendanceSheets[0])return null;for(var t=0;t<this.sortedAttendanceSheets[0].length;t+=1)for(var e=1;e<this.sortedAttendanceSheets.length;e+=1){var n=this.sortedAttendanceSheets[e-1][t].checking_status,s=this.sortedAttendanceSheets[e][t].checking_status;if(n!==s)return!1}return!0},attendanceStatusStats:function(){if(!this.columnDetails)return null;var t=[],e=!0,n=!1,s=void 0;try{for(var r,a=f()(this.columnDetails);!(e=(r=a.next()).done);e=!0){for(var i=r.value,c={},u=["normal","absent","lated","early_left"],o=0;o<u.length;o++){var l=u[o];c[l]=this.countStatus(i,l)}t.push(c)}}catch(h){n=!0,s=h}finally{try{e||null==a.return||a.return()}finally{if(n)throw s}}return t},studentCount:function(){return this.columnDetails&&this.columnDetails[0]?this.columnDetails[0].results.length:0},recordedStudentCount:function(){var t=0;return this.displayAttendanceSheets&&_.forEach(this.displayAttendanceSheets,function(e){e.attendance&&e.attendance[0]&&e.attendance[0].created_at&&(t+=1)}),t},attendanceSaveData:function(){if(this.displayAttendanceSheets&&this.displayAttendanceSheets[0]){for(var t=[],e=0;e<this.displayAttendanceSheets[0].attendance.length;e+=1){var n={},s=!0,r=!1,a=void 0;try{for(var i,c=f()(this.displayAttendanceSheets);!(s=(i=c.next()).done);s=!0){var u=i.value;n[u.user.id]=u.attendance[e].checking_status}}catch(o){r=!0,a=o}finally{try{s||null==c.return||c.return()}finally{if(r)throw a}}t.push(n)}return t}return null},isAllowModify:function(){var t=moment().format(j),e=moment(this.currentDate).format(j),n=moment(t).diff(e,"days");return n>=0&&n<this.allowUpdateInDays},isBanRepair:function(){return!!this.disallowLateSubmissions&&(this.disallowLateSubmissions&&!this.isAllowModify)},currentUser:function(){return y["a"].identity}},watch:{currentDate:function(){this.$emit("change-lesson","")},currentLesson:function(){this.loadData()},sortedAttendanceSheets:function(){this.displayAttendanceSheets=this.tidyAttendanceSheets()}},created:function(){this.eventHub.$on("save-sheets",this.saveSheets)},beforeDestroy:function(){this.eventHub.$off("save-sheets",this.saveSheets)},mounted:function(){var t=Object(h["a"])(regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return this.loadData(),t.next=3,S["a"].getAsNumber("attendance.allow-update-in-days");case 3:if(t.t0=t.sent,t.t0){t.next=6;break}t.t0=3;case 6:return this.allowUpdateInDays=t.t0,t.next=9,S["a"].getAsBoolean("attendance.disallow-late-submissions");case 9:this.disallowLateSubmissions=t.sent;case 10:case"end":return t.stop()}},t,this)}));function e(){return t.apply(this,arguments)}return e}(),methods:{loadData:function(){var t=Object(h["a"])(regeneratorRuntime.mark(function t(){var e,n,s,r,a,i,c,u,h,d,v,b,g,S,y,w,k,x,C,A,L,D,$,N,E,R,j=this;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:if(e=this.currentClass&&this.currentClass.id,e){t.next=3;break}return t.abrupt("return");case 3:return t.next=5,p["a"].getColumns(e);case 5:if(n=t.sent,s=this.currentUser.reflection.id,r=this.classAdjustmentHelper,a=r.finalAdjustmentResult,i=r.classAdjustmentSemester,c={},u=this.currentDate,d=i.getWhichWeekAndDayByDate(u),v=d.week,b=d.day,g=_.filter(_.get(a,e,[]),function(t){var e=Object(l["a"])(t.after,2),n=e[0],s=e[1];return"subs"===t.type&&v===n&&b===s}),g.length&&(S=n.fields,y=[],_.forEach(g,function(t){var e=t.before,n=t.fromTeacher,r=t.toTeacher,a="".concat(u,":").concat(e[2]);n.id===s?_.remove(S,function(t){return t===a}):r.id===s&&y.push(a)}),y.length&&(n.fields=y)),n.fields&&n.fields.length){t.next=16;break}return this.$emit("update:hasAttendance",!1),t.abrupt("return");case 16:for(w=!0,k=!1,x=void 0,t.prev=19,C=f()(n.fields);!(w=(A=C.next()).done);w=!0)L=A.value,D=L.split(":"),$=Object(l["a"])(D,2),N=$[0],E=$[1],c[N]||(c[N]={name:this.$options.filters.filterDate(N),value:N,lessons:[]}),c[N].lessons.push(+E),h=N;t.next=27;break;case 23:t.prev=23,t.t0=t["catch"](19),k=!0,x=t.t0;case 27:t.prev=27,t.prev=28,w||null==C.return||C.return();case 30:if(t.prev=30,!k){t.next=33;break}throw x;case 33:return t.finish(30);case 34:return t.finish(27);case 35:if(this.columns=c,this.columns[this.currentDate]||(u=h),this.dateOptions=o()(c),this.lessonDistribute=this.mergeLessons(this.columns[u].lessons),R=this.currentLesson||this.columns[u].lessons[0],!this.columns[this.currentDate]||!_.some(this.columns[this.currentDate].lessons,function(t){return t===+j.currentLesson})){t.next=43;break}return t.next=43,this.getColumnDetail();case 43:return t.next=45,m["a"].get("attendance-sort");case 45:if(t.t1=t.sent,t.t1){t.next=48;break}t.t1="usin";case 48:this.sort=t.t1,this.classMerged=this.classMergedStatus,this.tellParentsData(),this.$emit("change-date",u),this.$emit("change-lesson",R);case 53:case"end":return t.stop()}},t,this,[[19,23,27,35],[28,,30,34]])}));function e(){return t.apply(this,arguments)}return e}(),countStatus:function(t,e){return t.results?t.results.filter(function(t){return t.checking_status===e}).length:t.filter(function(t){return t.checking_status===e}).length},saveSheets:function(){var t=Object(h["a"])(regeneratorRuntime.mark(function t(){var e,n,s,r=this;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:if(!(!this.isNewSheet&&!this.isAllowModify||this.isNewSheet&&this.isBanRepair)){t.next=3;break}return toast.error(Vue.t("超出考勤期限，无法录入或修改考勤")),t.abrupt("return");case 3:return e=0,n=this.isNewSheet?"createColumnSheets":"updateColumnSheets",s=this.sortedAttendanceSheets.map(function(t,s){return new c.a(function(){var t=Object(h["a"])(regeneratorRuntime.mark(function t(a){return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,p["a"][n](r.currentClass.id,r.currentDate,+r.currentLessonStart+s,r.attendanceSaveData[s]);case 3:e+=1,t.next=9;break;case 6:t.prev=6,t.t0=t["catch"](0),console.error(t.t0);case 9:a();case 10:case"end":return t.stop()}},t,null,[[0,6]])}));return function(e){return t.apply(this,arguments)}}())}),t.next=8,c.a.all(s);case 8:this.isNewSheet?e===this.currentLessonsArray.length?toast.success(Vue.t("考勤记录添加成功")):0===e?toast.error(Vue.t("考勤记录添加失败")):toast.error(Vue.t("提交存在异常，请刷新后重新提交")):e===this.currentLessonsArray.length?toast.success(Vue.t("考勤记录修改成功")):0===e?toast.error(Vue.t("考勤记录修改失败")):toast.error(Vue.t("提交存在异常，请刷新后重新提交")),this.showSaveButton?this.tellParentOrder():this.loadData();case 10:case"end":return t.stop()}},t,this)}));function e(){return t.apply(this,arguments)}return e}(),changeAttendanceStatus:function(t,e){if("array"!==Object(b["j"])(t))t.checking_status=e;else{var n=!0,s=!1,r=void 0;try{for(var a,i=f()(t);!(n=(a=i.next()).done);n=!0){var c=a.value;c.checking_status=e}}catch(u){s=!0,r=u}finally{try{n||null==i.return||i.return()}finally{if(s)throw r}}}this.tellParentsData()},batchEdit:function(t,e){if(this.displayAttendanceSheets){var n=0;_.forEach(this.displayAttendanceSheets,function(s){e&&!e.includes(s.user.usin)||(_.forEach(s.attendance,function(e){e.checking_status=t}),n+=1)});var s=e?e.length-n:0;s?toast.success("成功标记了".concat(n,"个学生，有").concat(s,"个学号未找到对应的学生")):toast.success("成功标记了".concat(n,"个学生")),this.tellParentsData()}},getColumnDetail:function(){var t=Object(h["a"])(regeneratorRuntime.mark(function t(){var e,n,s=this;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return this.columnDetails.length=0,e=[],n=_.map(this.currentLessonsArray,function(t){return new c.a(function(){var n=Object(h["a"])(regeneratorRuntime.mark(function n(r){var i,c;return regeneratorRuntime.wrap(function(n){while(1)switch(n.prev=n.next){case 0:return i="".concat(s.currentDate,":").concat(t),n.next=3,p["a"].getColumnDetail(s.currentClass.id,i);case 3:c=n.sent,e.push(Object(a["a"])({},c,{lesson:t})),r();case 6:case"end":return n.stop()}},n)}));return function(t){return n.apply(this,arguments)}}())}),t.next=5,c.a.all(n);case 5:this.columnDetails=_.sortBy(e,function(t){return t.lesson});case 6:case"end":return t.stop()}},t,this)}));function e(){return t.apply(this,arguments)}return e}(),setSort:function(t){this.sort=t,m["a"].set("attendance-sort",t)},mergeLessons:function(t){var e=_.sortBy(t);e.push("0");for(var n={},s=[],r=0;r<e.length-1;r+=1)+e[r]===+e[r+1]-1?s.push(+e[r]):(s.push(+e[r]),n[s[0]]=s,s=[]);return n},tidyAttendanceSheets:function(){var t=this,e=[];if(!this.sortedAttendanceSheets||!this.sortedAttendanceSheets[0])return e;for(var n=function(n){var s={};s.user=t.sortedAttendanceSheets[0][n].user,s.attendance=[],s.isLeave={status:{1:[],2:[],3:[],4:[],5:[]},leave_count:0,most_status:0,tooltip_value:""};for(var r=0;r<t.sortedAttendanceSheets.length;r+=1){s.attendance.push(t.sortedAttendanceSheets[r][n]);var a=t.sortedAttendanceSheets[r][n].absence_status;"normal"!==a&&(s.isLeave.status[+a].push(+t.currentLesson+r),s.isLeave.leave_count+=1)}if(0!==s.isLeave.leave_count){var i=_.maxBy(_.values(s.isLeave.status),function(t){return t.length})[0],c=i-t.currentLesson;s.isLeave.most_status=t.sortedAttendanceSheets[c][n].absence_status;var u=_.keys(s.isLeave.status),o=_.reduce(u,function(e,n){if(s.isLeave.status[n].length<=0)return e;var r=t.$options.filters.filterAbsenceStatus(n),a=[];return a=t.currentSemester.isUsingCustomLessonName?_.map(s.isLeave.status[n],function(e){return t.transformLesson(e,t.currentSemester)}).join(","):"第".concat(s.isLeave.status[n].join(","),"节"),e.push("".concat(a,"请假").concat(r)),e},[]);s.isLeave.tooltip_value=o.join("; ")}e.push(s)},s=0;s<this.sortedAttendanceSheets[0].length;s+=1)n(s);return e},changeClassMerged:function(t){t?this.classMergedStatus?this.classMerged=!0:toast.error("存在不一致的分堂考勤，无法切换至连堂考勤"):this.classMerged=!1},tellParentsData:function(){this.$emit("data-refresh",{dateOptions:this.dateOptions,currentDate:this.currentDate,lessonDistribute:this.lessonDistribute,currentLesson:this.currentLesson,attendanceStatusStats:this.attendanceStatusStats,isNewSheet:this.isNewSheet,canEdit:this.isAllowModify,isBanRepair:this.isBanRepair})},tellParentOrder:function(){this.$emit("data-commit",{currentLesson:this.currentLesson,currentClassId:this.currentClass.id,isNewSheet:this.isNewSheet})},isRecordedNormal:function(t){return t&&"normal"===t.checking_status&&t.created_at},viewLeave:function(t){var e=this.$router.resolve({name:"teacherLeavesApprove",query:{identity:t.user.usin,ends_in_egt:this.currentDate,starts_at_elt:this.currentDate}});window.open(e.href,"_blank")}},i18n:{messages:{"en-US":{"待":"P","请":"A","驳":"R","销":"销"}}}},U=O,B=(n("91ce"),Object(N["a"])(U,s,r,!1,null,"a7226b68",null));e["a"]=B.exports},"91ce":function(t,e,n){"use strict";var s=n("c7e0"),r=n.n(s);r.a},"99b6":function(t,e,n){"use strict";n.d(e,"a",function(){return h});n("6762"),n("2fdb"),n("ac6a"),n("28a5");var s=n("768b"),r=(n("55dd"),n("96cf"),n("3b8d")),a=n("d225"),i=n("b0b4"),c=n("308d"),u=n("6bb5"),o=n("4e2b"),l=n("3fa7"),h=function(t){function e(){return Object(a["a"])(this,e),Object(c["a"])(this,Object(u["a"])(e).apply(this,arguments))}return Object(o["a"])(e,t),Object(i["a"])(e,null,[{key:"createClassBaseUrl",value:function(t){return"".concat(this.baseURL,"/").concat(this.controller,"/").concat(t)}},{key:"findAllColumns",value:function(){var t=Object(r["a"])(regeneratorRuntime.mark(function t(){var e,n,s,r=arguments;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return e=r.length>0&&void 0!==r[0]?r[0]:{},n="".concat(this.baseURL,"/").concat(this.controller,"/columns/$query"),t.next=4,this.$http.post(n,e);case 4:return s=t.sent,t.abrupt("return",s);case 6:case"end":return t.stop()}},t,this)}));function e(){return t.apply(this,arguments)}return e}()},{key:"getColumns",value:function(){var t=Object(r["a"])(regeneratorRuntime.mark(function t(e,n){var r,a,i=this;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return r=this.createClassBaseUrl(e),t.next=3,this.getJSON(r,n);case 3:return a=t.sent,a.fields.sort(function(t,e){var n=t.split(":"),r=Object(s["a"])(n,2),a=r[0],i=r[1],c=e.split(":"),u=Object(s["a"])(c,2),o=u[0],l=u[1];return a<o?-1:a===o?i-l:1}),a.values.forEach(function(t){_.forEach(t.results,function(t){t&&([i.ABSENCE_STATUS.VERIFIED,i.ABSENCE_STATUS.EVIDENCE_VERIFIED].includes(t.absence_status)?t.result_status="granted_leave":t.result_status=t.result)})}),t.abrupt("return",new this(a));case 7:case"end":return t.stop()}},t,this)}));function e(e,n){return t.apply(this,arguments)}return e}()},{key:"getColumnDetail",value:function(t,e,n){var s="".concat(this.createClassBaseUrl(t),"/columns/").concat(e);return this.getJSON(s,n)}},{key:"createColumnSheets",value:function(t,e,n,s){var r="".concat(this.createClassBaseUrl(t),"/columns"),a={checked_at:e,lesson:n,results:s};return this.$http.post(r,a)}},{key:"updateColumnSheets",value:function(t,e,n,s){var r="".concat(this.createClassBaseUrl(t),"/columns/").concat(e,":").concat(n);return this.$http.put(r,s)}},{key:"NAME",get:function(){return"AttendanceSheets"}},{key:"ABSENCE_STATUS",get:function(){return{VERIFIED:2,EVIDENCE_VERIFIED:5}}},{key:"controller",get:function(){return"attendancesheets"}}]),e}(l["a"])},aa3b:function(t,e,n){t.exports=n.p+"img/default-rectangle-avatar.1a56cc91.svg"},b577:function(t,e,n){"use strict";var s=n("374d"),r=n.n(s);r.a},c201:function(t,e,n){},c7e0:function(t,e,n){},f4e3:function(t,e,n){t.exports=n.p+"img/default-avatar.260b11a6.svg"}}]);