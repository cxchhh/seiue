(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-463b0fac"],{"0657":function(e,t,n){
/*! FileSaver.js
 *  A saveAs() FileSaver implementation.
 *  2014-01-24
 *
 *  By Eli Grey, http://eligrey.com
 *  License: X11/MIT
 *    See LICENSE.md
 */
/*! @source http://purl.eligrey.com/github/FileSaver.js/blob/master/FileSaver.js */
var r=r||"undefined"!==typeof navigator&&navigator.msSaveOrOpenBlob&&navigator.msSaveOrOpenBlob.bind(navigator)||function(e){"use strict";if("undefined"===typeof navigator||!/MSIE [1-9]\./.test(navigator.userAgent)){var t=e.document,n=function(){return e.URL||e.webkitURL||e},r=e.URL||e.webkitURL||e,s=t.createElementNS("http://www.w3.org/1999/xhtml","a"),a=!e.externalHost&&"download"in s,c=e.webkitRequestFileSystem,o=e.requestFileSystem||c||e.mozRequestFileSystem,i=function(t){(e.setImmediate||e.setTimeout)(function(){throw t},0)},u="application/octet-stream",l=0,d=[],f=function(){var e=d.length;while(e--){var t=d[e];"string"===typeof t?r.revokeObjectURL(t):t.remove()}d.length=0},h=function(e,t,n){t=[].concat(t);var r=t.length;while(r--){var s=e["on"+t[r]];if("function"===typeof s)try{s.call(e,n||e)}catch(a){i(a)}}},m=function(r,i){var f,m,p,_=this,y=r.type,v=!1,b=function(){var e=n().createObjectURL(r);return d.push(e),e},j=function(){h(_,"writestart progress write writeend".split(" "))},g=function(){!v&&f||(f=b(r)),m?m.location.href=f:window.open(f,"_blank"),_.readyState=_.DONE,j()},w=function(e){return function(){if(_.readyState!==_.DONE)return e.apply(this,arguments)}},k={create:!0,exclusive:!1};if(_.readyState=_.INIT,i||(i="download"),a){f=b(r),t=e.document,s=t.createElementNS("http://www.w3.org/1999/xhtml","a"),s.href=f,s.download=i;var A=t.createEvent("MouseEvents");return A.initMouseEvent("click",!0,!1,e,0,0,0,0,0,!1,!1,!1,!1,0,null),s.dispatchEvent(A),_.readyState=_.DONE,void j()}e.chrome&&y&&y!==u&&(p=r.slice||r.webkitSlice,r=p.call(r,0,r.size,u),v=!0),c&&"download"!==i&&(i+=".download"),(y===u||c)&&(m=e),o?(l+=r.size,o(e.TEMPORARY,l,w(function(e){e.root.getDirectory("saved",k,w(function(e){var t=function(){e.getFile(i,k,w(function(e){e.createWriter(w(function(t){t.onwriteend=function(t){m.location.href=e.toURL(),d.push(e),_.readyState=_.DONE,h(_,"writeend",t)},t.onerror=function(){var e=t.error;e.code!==e.ABORT_ERR&&g()},"writestart progress write abort".split(" ").forEach(function(e){t["on"+e]=_["on"+e]}),t.write(r),_.abort=function(){t.abort(),_.readyState=_.DONE},_.readyState=_.WRITING}),g)}),g)};e.getFile(i,{create:!1},w(function(e){e.remove(),t()}),w(function(e){e.code===e.NOT_FOUND_ERR?t():g()}))}),g)}),g)):g()},p=m.prototype,_=function(e,t){return new m(e,t)};return p.abort=function(){var e=this;e.readyState=e.DONE,h(e,"abort")},p.readyState=p.INIT=0,p.WRITING=1,p.DONE=2,p.error=p.onwritestart=p.onprogress=p.onwrite=p.onabort=p.onerror=p.onwriteend=null,e.addEventListener("unload",f,!1),_.unload=function(){f(),e.removeEventListener("unload",f,!1)},_}}("undefined"!==typeof self&&self||"undefined"!==typeof window&&window||this.content);e.exports=r},"09ee":function(e,t,n){"use strict";n.d(t,"d",function(){return l}),n.d(t,"a",function(){return d}),n.d(t,"b",function(){return f}),n.d(t,"c",function(){return h});var r=n("cebc"),s=n("d225"),a=n("b0b4"),c=n("308d"),o=n("6bb5"),i=n("4e2b"),u=n("3fa7"),l=function(e){function t(){return Object(s["a"])(this,t),Object(c["a"])(this,Object(o["a"])(t).apply(this,arguments))}return Object(i["a"])(t,e),Object(a["a"])(t,[{key:"batchCreateSchedules",value:function(e){var t="".concat(this.constructor.baseURL,"/").concat(this.constructor.controller,"/").concat(this.primary,"/schedules/$batch");return this.$http.post(t,e)}},{key:"batchDeleteSchedules",value:function(){var e="".concat(this.constructor.baseURL,"/").concat(this.constructor.controller,"/").concat(this.primary,"/schedules");return this.$http.delete(e)}},{key:"isSwap",get:function(){return this.type===t.TYPE.swap}},{key:"isSubs",get:function(){return this.type===t.TYPE.subs}},{key:"isRecalled",get:function(){return this.status===t.STATUS.recalled}}],[{key:"getStats",value:function(e){var t="".concat(this.baseURL,"/").concat(this.controller,"/stats");return this.$http.get(t,{params:Object(r["a"])({},e)})}},{key:"getRecommendations",value:function(e){var t="".concat(this.baseURL,"/").concat(this.controller,"/recommendations");return this.$http.get(t,{params:Object(r["a"])({},e)})}},{key:"getConflicts",value:function(e){var t="".concat(this.baseURL,"/").concat(this.controller,"/conflicts");return this.$http.get(t,{params:Object(r["a"])({},e)})}},{key:"defaults",get:function(){return{from_rid:"",from_start_at:"",from_end_in:"",to_rid:"",to_start_at:"",to_end_in:""}}},{key:"controller",get:function(){return"class-adjustments"}},{key:"TYPE",get:function(){return{swap:"swap",subs:"subs"}}},{key:"STATUS",get:function(){return{normal:"normal",recalled:"recalled"}}},{key:"PROGRESS",get:function(){return{pending:"pending",ongoing:"ongoing",ended:"ended"}}}]),t}(u["a"]),d=l.PROGRESS,f=l.STATUS,h=l.TYPE},"15a6":function(e,t,n){"use strict";n.d(t,"a",function(){return b});var r=n("5d73"),s=n.n(r),a=(n("6b54"),n("7514"),n("20d6"),n("75fc")),c=n("cebc"),o=n("795b"),i=n.n(o),u=(n("ac6a"),n("5df3"),n("768b")),l=(n("96cf"),n("3b8d")),d=n("d225"),f=n("b0b4"),h=n("d1b0"),m=n("ab0f"),p=n("09ee"),y=n("a247"),v=Vue.t,b=function(){function e(){Object(d["a"])(this,e),this.classAdjustments=[],this._finalAdjustmentResult={},this._classAdjustmentSemester={},this._classAdjustmentUser={}}return Object(f["a"])(e,[{key:"getReflectionByUser",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this._classAdjustmentUser;return _.isEmpty(e.reflection)?e:e.reflection}},{key:"validUserIsTeacher",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this._classAdjustmentUser;return _.isEmpty(e.reflection)?e instanceof m["a"]:e.isTeacher}},{key:"initClassAdjustments",value:function(){var e=Object(l["a"])(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.getClassAdjustments();case 2:this.classAdjustments=e.sent,this._finalAdjustmentResult=this.getFinalAdjustmentResult();case 4:case"end":return e.stop()}},e,this)}));function t(){return e.apply(this,arguments)}return t}()},{key:"getClassAdjustments",value:function(){var e=Object(l["a"])(regeneratorRuntime.mark(function e(){var t,n,r,s,o,l,d,f,h,m,_;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return t=this.classAdjustmentSemester,n=t.id,r=t.start_at,s=t.end_in,o={status:p["b"].normal,semester_id:n,"per-page":9999,page:1,expand:["class_adjustment_schedules","class_adjustment_schedules.from_class","class_adjustment_schedules.to_class","from_teacher","to_teacher"],start_at:r,end_in:s},l=this.validUserIsTeacher(),d=l?this.getReflectionByUser().usin:null,e.next=6,i.a.all([p["d"].findAll(Object(c["a"])({},o,{type:p["c"].swap})),p["d"].findAll(Object(c["a"])({},o,{type:p["c"].subs,"teacher.identity":d,expand:[].concat(Object(a["a"])(o.expand),["class_adjustment_schedules.from_class.schedules","class_adjustment_schedules.from_class.subject"])}))]);case 6:return f=e.sent,h=Object(u["a"])(f,2),m=h[0],_=h[1],e.abrupt("return",[].concat(Object(a["a"])(m),Object(a["a"])(_)));case 11:case"end":return e.stop()}},e,this)}));function t(){return e.apply(this,arguments)}return t}()},{key:"getMixedClasses",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=moment().format("YYYY-MM-DD");_.defaults(e,{classes:[],user:this._classAdjustmentUser,date:{startAt:t,endIn:t}});var n=e.classes,r=e.date,s=e.user,a=this.classAdjustmentSemester,o=_.cloneDeep(n),i=[],l=this.getReflectionByUser(s).id,d=this.validUserIsTeacher(s),f=this.finalAdjustmentResult,m=r.startAt===r.endIn,y=a.getWhichWeekAndDayByDate(r.startAt),v=y.week,b=y.day,j=function(e,t){var n=t.fromClass,r=t.toTeacher;return(e.teachers||[]).some(function(t){return n.id===e.id&&t.teacher_id===l&&r.id===l})};return o.forEach(function(e){var t=e.schedules,n=_.cloneDeep(t);if(t){var r=f[e.id];if(r&&r.length){r.forEach(function(r){if(!j(e,r)){var s=r.before,a=r.after,o=r.type,i=Object(u["a"])(s,3),f=i[0],y=i[1],b=i[2],g=Object(u["a"])(a,3),w=g[0],k=g[1],A=g[2],S={type:o,from_class:new h["default"](r.fromClass),from_teacher:r.fromTeacher,to_class:new h["default"](r.toClass),to_teacher:r.toTeacher},O=f===v,R=w===v;if(O||R){var T=_.findIndex(t,function(e){var t=e.day,n=e.lesson;return m?t===k&&n===A:t===y&&n===b}),E=n.find(function(e){var t=e.day,n=e.lesson;return m?t===k&&n===A:t===y&&n===b});E&&(O&&R?-1!==T&&(o===p["c"].subs&&d?r.fromTeacher.id===l?e.schedules.splice(T,1):r.toTeacher.id===l&&(t[T].adjustment=S):_.merge(t[T],{day:k,lesson:A,adjustment:S})):O?-1!==T&&e.schedules.splice(T,1):R&&(m?-1!==T&&(t[T].adjustment=S):(e.start_at>w&&(e._adjustment_start_at=w),e.end_in<w&&(e._adjustment_end_in=w),e.schedules.push(Object(c["a"])({},_.cloneDeep(E),{day:k,lesson:A,adjustment:S})))))}}});var s=e._adjustment_start_at,a=e._adjustment_end_in;if((s||a)&&(e.start_at=s||e.start_at,e.end_in=a||e.end_in,e.schedules=e.schedules.filter(function(e){return e.adjustment})),d){var o=_.find(r,function(t){if(j(e,t))return!1;var n=t.type,r=t.fromClass,s=t.toTeacher;return n===p["c"].subs&&r.id===e.id&&s.id===l});if(!o)return;var y=-1!==_.findIndex(e.schedules,function(e){return _.get(e.adjustment,"type","")===p["c"].subs});if(o&&o.toTeacher.id===l)return void(y?e.schedules=_.filter(e.schedules,function(e){return e.adjustment&&e.adjustment.type===p["c"].subs}):i.push(e))}m&&(e.schedules=_.filter(e.schedules,{day:b}))}}}),_.forEach(i,function(e){_.remove(o,e)}),o}},{key:"getFinalAdjustmentResult",value:function(){var e=this,t=this.classAdjustments,n=this.classAdjustmentSemester;if(!t||!n)return[];var r={},a=function(e){var t=e.type,n=e.from_class,a=e.from_class_id,c=e.from_day,o=e.from_lesson,i=e.from_week,u=e.from_teacher,l=e.from_pre_adjustment_id,d=e.to_day,f=e.to_lesson,h=e.to_week,m=e.to_teacher,_=[i,c,o],y=t===p["c"].swap,v=t===p["c"].subs,b=[h,d,f],j=e.to_class;r[a]||(r[a]=[]);var g=r[a].some(function(e){return e.fromClass.id===a&&b.toString()===e.after.toString()});if(!g)if(v&&(b=_,j=n),y&&0===l||v)r[a].push({type:t,before:_,after:b,fromClass:n,toClass:j,fromTeacher:u,toTeacher:m});else{var w=!0,k=!1,A=void 0;try{for(var S,O=s()(r[a]);!(w=(S=O.next()).done);w=!0){var R=S.value;_.toString()===R.after.toString()?(R.after=b,R.toClass=j,R.toTeacher=m,R.type=t):b.toString()===R.after.toString()&&(R.after=_,R.toClass=n,R.toTeacher=u,R.type=t)}}catch(T){k=!0,A=T}finally{try{w||null==O.return||O.return()}finally{if(k)throw A}}}};return _.forEach(_.sortBy(t,["updated_at"]),function(t){var r=t.type,s=t.from_teacher,o=t.to_teacher,i=t.from_start_at,u=t.to_start_at,l=t.class_adjustment_schedules,d=n.getWhichWeekAndDayByDate(i).week,f=n.getWhichWeekAndDayByDate(u).week;_.forEach(l,function(n){var i=Object(c["a"])({},n,{type:r,from_teacher:s,to_teacher:o,from_week:d,to_week:f});a(i),t.isSwap&&a(e.constructor.flipAttributes(i))})}),r}},{key:"formatTypeBySchedule",value:function(e){var t=_.get(e,"adjustment.type","");return t?"".concat(this.constructor.formatAdjustmentType(t)):""}},{key:"formatTypeByClassIdAndDate",value:function(e){if(!e)return"";var t=e.classId,n=e.date,r=e.lesson,s=this.finalAdjustmentResult,a=s&&s[t];if(!a)return"";var c=this.classAdjustmentSemester.getWhichWeekAndDayByDate(n),o=c.week,i=c.day,l=_.find(a,function(e){var t=Object(u["a"])(e.after,3),n=t[0],s=t[1],a=t[2];return r?o===n&&i===s&&+r===+a:o===n&&i===s});return l?"(".concat(this.constructor.formatAdjustmentType(l.type),")"):""}},{key:"getAdjustmentTooltip",value:function(e){if(!e)return"";var t=e.day,n=e.lesson,r=e.adjustment,s=r.type,a=r.to_class,c=r.to_teacher,o=this.classAdjustmentSemester,i=c.name,u="".concat(Vue.options.filters.filterWeek(t)," ").concat(Object(y["a"])(n,o));return s===p["c"].swap?"当前课程与 ".concat(a.name," ").concat(a.class_name," 对调<br>（任课教师：").concat(i," 上课时间：").concat(u,"）"):"当前课程由 ".concat(i," 老师代课")}},{key:"finalAdjustmentResult",get:function(){return this._finalAdjustmentResult}},{key:"classAdjustmentSemester",get:function(){return this._classAdjustmentSemester}}],[{key:"flipAttributes",value:function(e){for(var t=_.cloneDeep(e),n=["class","class_id","day","lesson","pre_adjustment_id","week","teacher"],r=0;r<n.length;r++){var s=n[r],a="from_".concat(s),c="to_".concat(s);t[a]=e[c],t[c]=e[a]}return t}},{key:"formatAdjustmentType",value:function(e){return e?e===p["c"].swap?v("调课"):v("代课"):""}},{key:"createInstance",value:function(){var t=Object(l["a"])(regeneratorRuntime.mark(function t(n){var r,s,a;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:if(r=n.semester,s=n.user,r){t.next=3;break}throw new Error("Please provide a semester object.");case 3:return a=new e,a._classAdjustmentSemester=r,a._classAdjustmentUser=s||{},t.next=8,a.initClassAdjustments();case 8:return t.abrupt("return",a);case 9:case"end":return t.stop()}},t)}));function n(e){return t.apply(this,arguments)}return n}()}]),e}()},ab0f:function(e,t,n){"use strict";n.d(t,"a",function(){return f});n("96cf");var r=n("3b8d"),s=n("d225"),a=n("b0b4"),c=n("308d"),o=n("6bb5"),i=n("4e2b"),u=n("0657"),l=n.n(u),d=n("888c"),f=function(e){function t(){return Object(s["a"])(this,t),Object(c["a"])(this,Object(o["a"])(t).apply(this,arguments))}return Object(i["a"])(t,e),Object(a["a"])(t,null,[{key:"exportClassTimeStatistics",value:function(){var e=Object(r["a"])(regeneratorRuntime.mark(function e(t){var n,r;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.$http.post("".concat("https://chalkng.seiue.com","/excels/classes-hour/$query"),t,{responseType:"blob"});case 2:n=e.sent,r=new Blob([n],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),l()(r,"课时统计.xlsx");case 5:case"end":return e.stop()}},e,this)}));function t(t){return e.apply(this,arguments)}return t}()},{key:"defaults",get:function(){return{gender:"m",status:"1",role:t.role}}},{key:"NAME",get:function(){return"Teacher"}},{key:"role",get:function(){return 2}}]),t}(d["a"])}}]);